<div id="map_canvas" style="width:1100px; height:500px;"></div>

<div id="mapinfo">
    {% include 'analyses/report/_staticMapinfo.html' %}
</div>

<script type="text/javascript">
$(document).ready(function(){
    initializeMap();
});

var map = null;
var marker = null;

function initializeMap() {
    var lat = {{ analysis.report.metadata.gps.pos.Latitude|floatformat:6 }};
    var lon = {{ analysis.report.metadata.gps.pos.Longitude|floatformat:6 }};
    
    // Initialize Leaflet map with OpenStreetMap
    map = L.map('map_canvas').setView([lat, lon], 13);
    
    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19
    }).addTo(map);
    
    // Add marker
    marker = L.marker([lat, lon]).addTo(map)
        .bindPopup('Image location')
        .openPopup();
}

// Handle tab switching
$('a[data-toggle="tab"]').on('shown', function (e) {
    if (map) {
        map.invalidateSize();
    }
});
</script>