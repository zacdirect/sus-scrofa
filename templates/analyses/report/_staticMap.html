<div id="map_canvas" class="w-100 rounded-top" style="height: 500px;"></div>

<div id="mapinfo" class="p-3 bg-light rounded-bottom border-top">
    {% include 'analyses/report/_staticMapinfo.html' %}
</div>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    var map = L.map('map_canvas').setView([{{ analysis.report.metadata.gps.pos.Latitude }}, {{ analysis.report.metadata.gps.pos.Longitude }}], 13);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19
    }).addTo(map);
    
    L.marker([{{ analysis.report.metadata.gps.pos.Latitude }}, {{ analysis.report.metadata.gps.pos.Longitude }}]).addTo(map)
        .bindPopup('Image location')
        .openPopup();
        
    // Handle tab switching for map resizing
    var tabEl = document.querySelector('button[data-bs-target="#mapdiv"]');
    if (tabEl) {
        tabEl.addEventListener('shown.bs.tab', function (event) {
            map.invalidateSize();
        });
    }
    // Also handle if map is inside a tab that becomes active
    var triggerTabList = [].slice.call(document.querySelectorAll('button[data-bs-toggle="tab"]'))
    triggerTabList.forEach(function (triggerEl) {
      triggerEl.addEventListener('shown.bs.tab', function (event) {
        setTimeout(function(){ map.invalidateSize(); }, 200);
      })
    })
});
</script>